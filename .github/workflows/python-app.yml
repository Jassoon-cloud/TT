name: Python Selenium Script

on:
  push:
    branches:
      - main  # 或者你希望触发工作的其他分支
  workflow_dispatch:  # 允许手动触发工作流

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'  # 或其他你需要的Python版本

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Set up Chromium and ChromeDriver
        run: |
          sudo apt-get update
          sudo apt-get install -y chromium-browser
          
          # 获取当前安装的Chromium版本
          CHROMIUM_VERSION=$(chromium-browser --version | grep -oP '\d+\.\d+\.\d+\.\d+')
          echo "Chromium version: $CHROMIUM_VERSION"

          # 获取与Chromium版本相对应的ChromeDriver版本
          CHROMEDRIVER_VERSION=$(curl -sS "https://chromedriver.storage.googleapis.com/LATEST_RELEASE_${CHROMIUM_VERSION%.*}")
          echo "ChromeDriver version: $CHROMEDRIVER_VERSION"

          # 下载并安装ChromeDriver
          wget -N "http://chromedriver.storage.googleapis.com/${CHROMEDRIVER_VERSION}/chromedriver_linux64.zip"
          unzip chromedriver_linux64.zip
          chmod +x chromedriver
          mv chromedriver /usr/local/bin/

      - name: Run Selenium Script
        run: |
          # 设置显示环境变量
          export DISPLAY=:99
          python 取5个地区合并推送.py  # 将your_script.py替换为你的Python脚本文件名
